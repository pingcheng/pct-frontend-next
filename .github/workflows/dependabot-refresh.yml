name: Refresh Dependabot PRs

on:
  push:
    branches: [main]

jobs:
  refresh-dependabot:
    if: contains(github.event.head_commit.message, 'chore(deps')
    runs-on: ubuntu-latest
    steps:
      - name: Refresh conflicting dependabot PRs
        uses: actions/github-script@v7
        with:
          script: |
            // Get all open PRs created by dependabot
            const { data: prs } = await github.rest.pulls.list({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open'
            });
            
            // Comment on dependabot PRs to recreate them
            for (const pr of prs) {
              if (pr.user.login === 'dependabot[bot]') {
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: pr.number,
                  body: '@dependabot recreate'
                });
              }
            }